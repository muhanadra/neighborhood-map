"use strict";var allScenes;$.getJSON("scenes.json",function(a){allScenes=a,ko.applyBindings(new ViewModel)});var Scene=function(a){this.coordinates=a.coordinates,this.title=a.title,this.imgSrc=a.imgSrc,this.description=a.description,this.location=a.location,this.quote=a.quote},ViewModel=function(){var a=this,b={center:{lat:48.851302,lng:2.345127},zoom:15};this.map=new google.maps.Map(document.getElementById("map-canvas"),b),this.scenesList=ko.observableArray(),allScenes.forEach(function(b){a.scenesList.push(new Scene(b))});var c=a.scenesList().length;this.setMe=function(){e.setContent(this.node),this.map.setCenter(this.getPosition()),e.open(a.map,this),$("#sidebar").toggleClass("sidebar-open")},this.markersList=ko.observableArray();var d,e=new google.maps.InfoWindow({content:d,maxWidth:220}),f=function(b){var e="http://en.wikipedia.org/w/api.php?action=opensearch&search="+a.scenesList()[b].location+"&format=json&callback=wikiCallback",f=setTimeout(function(){return d='<div class="info"><h4>'+a.scenesList()[b].title+"</h4><p>"+a.scenesList()[b].description+"</p></div>"},3e3);if(d='<div class="info"><h4>'+a.scenesList()[b].title+"</h4><p>"+a.scenesList()[b].description+"</p></div>",localStorage.cachedContent){var g=localStorage.cachedContent,h=JSON.parse(g);d+=h[b],clearTimeout(f)}else $.ajax({type:"GET",url:e,async:!0,dataType:"jsonp",success:function(d){var e=d[1][0],g=d[3][0],h='<div class="Wikipedia"><a target="_blank" href="'+g+'">'+e+"</a></div>";e&&g?(a.markersList()[b].node=a.markersList()[b].node+h,a.markersList()[b].wiki=h):(a.markersList()[b].wiki='<div class="Wikipedia">No Wikipedia Articles found</div>',a.markersList()[b].node=a.markersList()[b].node+'<div class="Wikipedia">No Wikipedia Articles found</div>'),clearTimeout(f);var i=[];if(b===c-1){var j=function(){for(var b=0;c>b;b++)i.push(a.markersList()[b].wiki);var d=JSON.stringify(i);localStorage.setItem("cachedContent",d)};j()}}});return d},g=function(){for(var b=0;b<a.scenesList().length;b++){var c=new google.maps.LatLng(a.scenesList()[b].coordinates[0],a.scenesList()[b].coordinates[1]),d=new google.maps.Marker({position:c,map:a.map,title:a.scenesList()[b].title});a.markersList.push(d),d.node=f(b),d.wiki=null,d.imgSrc=a.scenesList()[b].imgSrc,google.maps.event.addListener(a.markersList()[b],"click",function(){return function(){e.setContent(this.node),this.map.setCenter(this.getPosition()),e.open(this.map,this)}}(a.markersList()[b].node))}};g()};$(".search").on("keyup",function(){var a=$(this).val().toLowerCase();$(".title").each(function(){var b=$(this).text().toLowerCase();$(this).closest(".scene-Item")[-1!==b.indexOf(a)?"show":"hide"]()})});
//# sourceMappingURL=app.min.map